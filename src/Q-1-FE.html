<form onsubmit="submitForm(event)">
    Username: <input type="text" name="username"><br>
    Password: <input type="password" name="password"><br>
    <input type="submit" value="Login">
</form>

<script>

    const submitForm = async (event) => {
        event.preventDefault();
        let username = document.getElementById("username").value;
        let password = document.getElementById("password").value;
        let usernameRegex = /^[a-zA-Z0-9_]{3}$/;
        let passwordRegex = /^(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{16,}$/;
        if (!usernameRegex.test(username)) {
            alert("Invalid username. Username must be more than 3 characters long");
            return;
        }
        if (!passwordRegex.test(password)) {
            alert(`Invalid password. Password must contain at least one number, 
            one lowercase and one uppercase letter, and at least 16 characters long`);
            return;
        }

        const encrypt = JSEncrypt();
        encrypt.setPublicKey(process.env.public_key);

        username = encrypt.encrypt(username);
        password = encrypt.encrypt(password);

        await fetch('/login', {
            method: 'POST',
            headers: {
            'Content-Type': 'application/json'
            },
            body: JSON.stringify({ username, password })
        })
        .then(response => response.json())
        .then(data => {
            alert("Login successful!");
            window.location.href = 'profile.html';
        })
        .catch(error => {
            alert("Login failed");
        });
    }
</script>